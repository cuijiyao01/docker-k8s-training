# Write your first helm chart
In this exercise you will author a very basic helm chart consisting of a config map with stores information about your favorite food & drinks.

## Documentation
The usage of helm and the go functions might not intuitive. There take a look at these links, they explain the most relevant:

* [overview of helm docs](https://github.com/kubernetes/helm/tree/master/docs)
* [how values files work in helm](https://github.com/kubernetes/helm/blob/master/docs/chart_template_guide/values_files.md)
* [functions and pipelines](https://github.com/kubernetes/helm/blob/master/docs/chart_template_guide/functions_and_pipelines.md)

## Useful commands & flags
* `--dry-run`: simulate your action (like installation or upgrade)
* `--debug`: print out the actual yaml files including the substituted values. Best used with `--dry-run` to test new functionality in your chart.
* `helm lint`: check your chart for yaml errors and correctness

## Draft the chart
### Chart initialization
Though you can create the directory structure as well as all the files manually, helm offers a `create` command.

`helm create <chart-name>` will bootstrap a chart structure with some first demo content for you. Unfortunately, most of the content is not relevant to you right now. But it can be a good source of inspiration.

### Remove superfluous templates
The `configmap` should be almost complete by now and it is time to clean up. Get rid of the templates which have been generated by `helm create`.
**Hint:** these templates are acutally valid & working. In case you need some inspiration, you may take a look into them as well prior to removal.

### Create the config map
Go to the `templates` folder and create new file, which will contain the yaml & code. Write a simple config map with a the following data structure:

```
data:
    favorite.drink: < your favorite drink >
    favorite.food: < your favorite food >
```

### Adapt values.yaml
Since everyones preferences for food and drinks differ, let's make them configurable. Firstly, delete the old `values.yaml` file - it refers to the generated templates and is not need for this exercise.

Instead create a new `values.yaml` file, which allows you to set values for `drink` and `food` in a `favorites` section. Check the documentation links above, if you are unsure, how to structure and indent the `values.yaml` content.

### Reference values in the template
Next, make use of the values you just defined and include them into data section of your config map.

To mark something as a variable or evaluate a function / pipeline, surround the statement with  `{{ }}`. To refer to a something from the `values.yaml`, start with `.Values` - it points to an object that contains all the data in your `values.yaml` file. Append `.<section>.<parameter>` to navigate through your values.

The values for food and drink will be strings. To make sure, they are treated correctly, you should hand the values over to the `quote` function by using a pipeline `|`. Check the "function and pipeline" link mentioned above for help.

You can use the `helm lint` command to have your code checked in a very basic way.

### Adapt the config map metadata
Now that the data is configurable, let's move on to `metadata`. Most of the times you want to include the release name the labels and name of your resources.
Luckily there are some built-in variables, like the `.Release` object with its `.Name` value. Change the specific name of your config map to include the release name in addition.

**Optional:** If you're up for a challenge, try to set some labels as well. Check the [built-in](https://github.com/kubernetes/helm/blob/master/docs/chart_template_guide/builtin_objects.md) objects for suitable values.

### Adapt NOTES.txt
Helm prints out some friendly words and an idea what to do next after a chart was deployed. These information is stored in the `NOTES.txt` file. Adapt the content to something meaningful (e.g. how to get the configmap or some of its content).

## Test & install
One last time, run the `helm lint` command and test your chart with a `--debug` & `--dry-run` installation.
If everything looks as expected, finally install your chart. Try to run the commands you put into the `NOTES.txt`.

Don't forget to query information about your release with `helm list`.

## Update
The last step in this exercise is to perform various updates on your release.
Use the `helm upgrade` command to bring your release to a new version. As part of an upgrade you can change the structure of the chart (**be very careful with this**) or simply change the values the chart is working with.

Try to run an upgrade and change `food` or `drink` with a `--set` command line parameter to a new value.

By default, the charts `values.yaml` file will be used. But of course you can overwrite it completely or by specifiying single values in a separate file. Create a file with custom values and use the `-f` flag to pass it on while upgrading.
